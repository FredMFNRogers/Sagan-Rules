##OKTA BRUTE FORCE ATTEMPT [1]
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[OKTA] BRUTE FORCE ATTEMPT [1]"; content: "Authentication failed: "; content:"user.authentication.auth_via_AD_agent"; xbits: set,brute_force,track ip_src, expire 21600; default_proto: tcp; default_dst_port: $SSH_PORT; classtype: brute-force; program: sshd; normalize; parse_src_ip: 1; parse_port; after: track by_src, count 10, seconds 300; threshold: type suppress, track by_src, count 1, seconds 300; reference: XXXXXX; sid: XXXXXX; rev:1;)
##Auto Comment: 'Brute Force Login failures for account name "XXX_alternateId_XXX" from source IP <ip>SRCIP</ip> <hn>SRCHOST</hn> reported by <ip>DSTIP</ip> <hn>DSTHOST</hn>. Quadrant recommends verifying if this is due to a configuration issue or a true brute force attempt.'
##Signature Playbook: 'This rule is designed to trigger on ten or more consecutive failed logins within five minutes per IP. This can be a sign of someone trying to brute force this account's password. This can also be indictive of a configuration issue.'
##Sample Logs:
##okta_system_log-20220607.log.gz:{"version":"0","uuid":"8675309-8675309-8675309-8675309","transaction":{"type":"WEB","id":"8675309"},"target[1]":{"type":"AppInstance","id":"8675309","displayName":"Active Directory","alternateId":"example.host"},"target[0]":{"type":"AppUser","id":"8675309","displayName":"USERNAME","alternateId":"USERNAME@example.host"},"severity":"ERROR","securityContext":{"isp":"verizon","isProxy":"false","domain":"verizon.net","asOrg":"verizon","asNumber":"701"},"request":{"ipChain[0]":{"version":"V4","ip":"8.8.8.8","geographicalContext":{"state":"STATE","postalCode":"1337","geolocation":{"lon":"XX.XXXXX","lat":"XX.XXXXX"},"country":"COUNTRY","city":"CITY"}}},"published":"2022-06-01T15:20:55.511Z","outcome":{"result":"FAILURE","reason":"Authentication failed: bad username or password"},"legacyEventType":"app.ad.login.bad_password","eventType":"user.authentication.auth_via_AD_agent","displayMessage":"Authenticate user with AD agent","debugContext":{"debugData":{"url":"/api/verify?rememberDevice=false","threatSuspected":"false","risk":"{level=LOW}","requestUri":"/api/v1/authn/factors/password/verify","requestId":"8675309","errorCode":"1337","deviceFingerprint":"8675309","delauthtimetotal":"471","delauthtimespentatdomaincontroller":"62","delauthtimespentatagent":"62","delauthtimeout":"18000","behaviors":"{New Geo-Location=NEGATIVE, New Device=NEGATIVE, New IP=NEGATIVE, New State=NEGATIVE, New Country=NEGATIVE, Velocity=NEGATIVE, New City=NEGATIVE}","actionid":"app.whatever.request?"}},"client":{"zone":"null","userAgent":{"rawUserAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.5005.63 Safari/537.36","os":"Windows 10","browser":"CHROME"},"ipAddress":"8.8.8.8","geographicalContext":{"state":"STATE","postalCode":"1337","geolocation":{"lon":"XX.XXXXX","lat":"XX.XXXXX"},"country":"COUNTRY","city":" CITY"},"device":"Computer"},"authenticationContext":{"interface":"AD APP Instance","externalSessionId":"8675309","credentialType":"PASSWORD","authenticationStep":"0","authenticationProvider":"ACTIVE_DIRECTORY"},"actor":{"type":"User","id":"8675309","displayName":"USERNAME","alternateId":"USERNAME@example.host"},"SOURCE":"s_okta-system-log","PROGRAM":"okta-system-log_relayer","HOST_FROM":"example.host","HOST":"example.host"}
