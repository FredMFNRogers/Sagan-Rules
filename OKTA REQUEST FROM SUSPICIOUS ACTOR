OKTA REQUEST FROM SUSPICIOUS ACTOR
alert any any any -> $HOME_NET any (msg: "[OKTA] REQUEST FROM SUSPICIOUS ACTOR"; content:"Request from suspicious actor"; normalize; parse_proto; parse_port; parse_src_ip: 1; parse_dst_ip: 2; default_proto: tcp; classtype: network-event; threshold: type suppress, track by_src, count 1, seconds 3600; reference: url,https://okta.github.io/okta-help/en/prod/Content/Topics/Security/threat-insight/configure-threatinsight.htm; sid:XXXXX; rev:1;)
##Auto Comment: 'Request from suspicious actor observed from source <ip>SRCIP</ip> (NAT'd source " XXX_ipChain1_XXX ") to the URL "XXX_url_XXX". This traffic received a response of "XXX_result_XXX" due to "XXX_reason_XXX". Quadrant recommends determining if this is due to a configuration issue or a malicious actor.'
##Signature Playbook: 'This rule is meant to trigger on the Okta warning log for "Request from suspicious actor". This will often be denied and will provide a reasoning such as "Password Spraying" or "Login Failures". If the result variable is something other than "DENY" indicating the traffic was indeed blocked, this should probably be treated as a critical alert. Use your best judgement. Remember to include any correlated logs that may be found on the PIE sensor for the referenced IP if this is the case.'
##Sample Logs:
##okta_system_log-19700101.log.gz:{"version":"0","uuid":"8675309-8675309-8675309-8675309","transaction":{"type":"WEB","id":"8675309"},"severity":"WARN","request":{"ipChain[1]":{"version":"V4","ip":"8.8.8.8"},"ipChain[0]":{"version":"V4","ip":"8.8.4.4"}},"published":"2022-06-02T09:53:16.314Z","outcome":{"result":"DENY","reason":"Password Spray"},"legacyEventType":"security.threat.detected","eventType":"security.threat.detected","displayMessage":"Request from suspicious actor","debugContext":{"debugData":{"url":"/app/office365/","threatSuspected":"true","threatDetections":"{\"Password Spray\":\"HIGH\"}","requestUri":"/app/office365/","requestId":"8675309"}},"client":{"zone":"null","userAgent":{"rawUserAgent":"unknown","os":"unknown","browser":"unknown"},"ipAddress":"8.8.8.8","device":"unknown"},"authenticationContext":{"authenticationStep":"0"},"actor":{"type":"IP address","id":"8.8.8.8","displayName":"8.8.8.8","alternateId":"unknown"},"SOURCE":"s_okta-system-log","PROGRAM":"okta-system-log_relayer","HOST_FROM":"example.host","HOST":"example.host"}
