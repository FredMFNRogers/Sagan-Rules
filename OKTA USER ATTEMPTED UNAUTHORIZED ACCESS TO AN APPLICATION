OKTA USER ATTEMPTED UNAUTHORIZED ACCESS TO AN APPLICATION
alert any any any -> any any (msg: "[OKTA] USER ATTEMPTED UNAUTHORIZED ACCESS TO AN APPLICATION"; content:"User attempted unauthorized access to app"; normalize; parse_proto; parse_port; parse_src_ip: 1; parse_dst_ip: 2; default_proto: tcp; classtype: network-event; threshold: type suppress, track by_src, count 1, seconds 300; reference: url,https://developer.okta.com/docs/reference/api/event-types/; sid:XXXXX; rev:1;)
 
##Auto Comment: 'An attempted unauthorized access for the application "XXX_displayName1_XXX"was observed for the user "XXX_alternateId2_XXX" from source <ip>SRCIP</ip> [XXX_city_XXX , XXX_country_XXX] with a risk level of "XXX_risk_XXX". Quadrant recommends determining if this is someone trying to bypass security restrictions or if this is related to a permissions configuration issue within Okta.'

##Signature Playbook: 'This rule is designed to trigger on a user trying to access an application for which they do not have asssigned permissions. This can be due to a misconfiguration or can be an attempt at accessing sensitive material by someone who is not privy to that information. This alert is mostly for correlation purposes and to notify the client of a potential issue with their permissions settings. The following variables in these logs can also be very helpful in determining how serious of a threat this could be: "New Geo-Location=NEGATIVE, New Device=NEGATIVE, New IP=NEGATIVE, New State=NEGATIVE, New Country=NEGATIVE, Velocity=NEGATIVE, New City=NEGATIVE".'

##sample logs:
##{"version":"0","uuid":"8675309-8675309-8675309-8675309","transaction":{"type":"WEB","id":"8675309"},"target[0]":{"type":"AppInstance","id":"8675309","displayName":"APPLICATION_NAME","alternateId":"APPLICATION_NAME_ALTERNATE"},"severity":"WARN","securityContext":{"isp":"INTERNET_SERVICE_PROVIDER","isProxy":"false","domain":".","asNumber":"1337"},"request":{"ipChain[0]":{"version":"V4","ip":"8.8.8.8","geographicalContext":{"state":"STATE","postalCode":"1337","geolocation":{"lon":"XX.XXXXX","lat":"XX.XXXXX"},"country":"COUNTRY","city":"CITY"}}},"published":"2022-06-13T14:34:45.592Z","outcome":{"result":"FAILURE"},"legacyEventType":"app.generic.unauth_app_access_attempt","eventType":"app.generic.unauth_app_access_attempt","displayMessage":"User attempted unauthorized access to app","debugContext":{"debugData":{"url":"/login/step-up/redirect?stateToken=8675309-8675309","risk":"{level=LOW}","requestUri":"/login/step-up/redirect","requestId":"8675309","behaviors":"{New Geo-Location=NEGATIVE, New Device=NEGATIVE, New IP=NEGATIVE, New State=NEGATIVE, New Country=NEGATIVE, Velocity=NEGATIVE, New City=NEGATIVE}"}},"client":{"zone":"null","userAgent":{"rawUserAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.5005.63 Safari/537.36","os":"Windows 10","browser":"CHROME"},"ipAddress":"8.8.8.8","geographicalContext":{"state":"STATE","postalCode":"1337","geolocation":{"lon":"XX.XXXXX","lat":"XX.XXXXX"},"country":"COUNTRY","city":"CITY"},"device":"Computer"},"authenticationContext":{"authenticationStep":"0"},"actor":{"type":"User","id":"8675309","displayName":"FIRSTUSER SURNAME","alternateId":"USER_PRINCIPAL_NAME"},"SOURCE":"s_okta-system-log","PROGRAM":"okta-system-log_relayer","HOST_FROM":"example.host","HOST":"example.host"}
