OKTA INBOUND REQUEST FROM BLACKLISTED IP
alert any any any -> any any (msg: "[OKTA] INBOUND REQUEST FROM A BLACKLISTED IP"; content:"Blacklisted request from "; normalize; parse_proto; parse_port; parse_src_ip: 1; parse_dst_ip: 2; default_proto: tcp; classtype: network-event; threshold: type suppress, track by_src, count 1, seconds 7200; reference: url,https://help.okta.com/en/prod/Content/Topics/Security/healthinsight/blocklist-network-zone.htm; sid:XXXXX; rev:1;)
##Auto Comment: 'An inbound request to "XXX_requestUri_XXX" was observed from the blacklisted source <ip>SRCIP</ip>. This request was XXX_outcome_XXX due to XXX_reason_XXX. This is an informational alert.'
##Signature Playbook: 'This rule was designed to trigger on inbound requests from blacklisted IPs to the Okta server. If the outcome variable is something other than "SUCCESS" indicating the traffic was indeed blocked, the line "This is an informational alert" should be changed to "Quadrant recommends determining why this request was not properly blocked". Remember to include any correlated logs that may be found on the PIE sensor for the referenced IP if this is the case.'
##Sample Logs:
##okta_system_log-19700101.log:{"version":"0","uuid":"8675309-8675309-8675309-8675309","transaction":{"type":"WEB","id":"8675309"},"severity":"WARN","request":{"ipChain[0]":{"version":"V4","ip":"8.8.8.8"}},"published":"1970-01-01T08:28:26.988Z","outcome":{"result":"SUCCESS","reason":"NETWORK_ZONE_BLACKLIST"},"legacyEventType":"security.zone.request.blocked","eventType":"security.request.blocked","displayMessage":"Blacklisted request from IP: 8.8.8.8, Proxy Type: tor, ASN: 41281","debugContext":{"debugData":{"url":"/home/potato","requestUri":"/home/pancakes","requestId":"8675309"}},"client":{"zone":"null","userAgent":{"rawUserAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36","os":"Windows 10","browser":"CHROME"},"ipAddress":"8.8.8.8","device":"Computer"},"authenticationContext":{"authenticationStep":"0"},"actor":{"type":"SystemPrincipal","id":"8675309","displayName":"Okta System","alternateId":"system@okta.com"},"SOURCE":"s_okta-system-log","PROGRAM":"okta-system-log_relayer","HOST_FROM":"example.host","HOST":"example.host"}
