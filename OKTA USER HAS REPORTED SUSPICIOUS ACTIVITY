OKTA USER HAS REPORTED SUSPICIOUS ACTIVITY
alert any any any -> any any (msg: "[OKTA] USER HAS REPORTED SUSPICIOUS ACTIVITY"; content:"User report suspicious activity"; normalize; parse_proto; parse_port; parse_src_ip: 1; parse_dst_ip: 2; default_proto: tcp; classtype: network-event; threshold: type suppress, track by_src, count 1, seconds 14400; reference: url,https://help.okta.com/en/prod/Content/Topics/Security/suspicious-activity-reporting.htm; sid:XXXXX; rev:1;)
##Auto Comment: 'The user "XXX_alternateId_XXX" has reported suspicious activity from the source <ip>SRCIP</ip> [XXX_city_XXX , XXX_country_XXX]. Suspicious Activity Reporting in Okta provides an end user with the option to report unrecognized activity from an account activity email notification. Quadrant recommends determining why this user reported this notification.'
##Signature Playbook: 'This rule is designed to trigger once per four hours by source IP on the "User report suspicious activity" event. As the auto-comment states, Suspicious Activity Reporting in Okta provides an end user with the option to report unrecognized activity from an account activity email notification. This alert is meant to notify the client of this event so they can investigate the issue further and is informational in nature.'
##Sample Logs:
##okta_system_log-20220607.log.gz:{"version":"0","uuid":"8675309-8675309-8675309-8675309","transaction":{"type":"WEB","id":"8675309"},"target[0]":{"type":"User","id":"8675309","displayName":"FIRSTNAME SURNAME","alternateId":"USER_PRINCIPAL_NAME"},"severity":"WARN","securityContext":{"isp":"verizon","isProxy":"false","domain":"verizon.net","asOrg":"verizon","asNumber":"701"},"request":{"ipChain[0]":{"version":"V4","ip":"8.8.8.8","geographicalContext":{"state":"STATE","postalCode":"1337","geolocation":{"lon":"XX.XXXXX","lat":"XX.XXXXX"},"country":"COUNTRY","city":"CITY"}}},"published":"2022-06-02T21:42:30.419Z","outcome":{"result":"SUCCESS"},"legacyEventType":"core.user.account.report_suspicious_activity_by_enduser","eventType":"user.account.report_suspicious_activity_by_enduser","displayMessage":"User report suspicious activity","debugContext":{"debugData":{"url":"/api/internal/users/me/report-suspicious-activity","targetEventHookIds":"8675309","suspiciousActivityTimestamp":"2022-06-02T21:19:15.793Z","suspiciousActivityOs":"Windows 10","suspiciousActivityEventType":"system.email.new_device_notification.sent_message","suspiciousActivityEventTransactionId":"8675309","suspiciousActivityEventState":"STATE","suspiciousActivityEventLongitude":"XX.XXXXX","suspiciousActivityEventLatitude":"XX.XXXXX","suspiciousActivityEventIp":"8.8.4.4","suspiciousActivityEventId":"8675309-8675309-8675309-8675309","suspiciousActivityEventCountry":"COUNTRY","suspiciousActivityEventCity":"CITY","suspiciousActivityBrowser":"CHROME","requestUri":"/api/internal/users/me/report-suspicious-activity","requestId":"8675309"}},"client":{"zone":"null","userAgent":{"rawUserAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36","os":"Windows 10","browser":"CHROME"},"ipAddress":"8.8.8.8","geographicalContext":{"state":"STATE","postalCode":"1337","geolocation":{"lon":"XX.XXXXX","lat":"XX.XXXXX"},"country":"COUNTRY","city":"CITY"},"device":"Computer"},"authenticationContext":{"externalSessionId":"8675309","authenticationStep":"0"},"actor":{"type":"User","id":"8675309","displayName":"FIRSTNAME SURNAME","alternateId":"USER_PRINCIPAL_NAME"},"SOURCE":"s_okta-system-log","PROGRAM":"okta-system-log_relayer","HOST_FROM":"example.host","HOST":"example.host"}
