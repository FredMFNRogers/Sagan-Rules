OKTA INVALID SELF SERVICE RECOVERY TOKEN USED BY USER
alert any any any -> any any (msg: "[OKTA] INVALID SELF SERVICE RECOVERY TOKEN USED BY USER"; content:"Invalid self service recovery token used by user"; content:"true" normalize; parse_proto; parse_port; parse_src_ip: 1; parse_dst_ip: 2; default_proto: tcp; classtype: network-event; threshold: type suppress, track by_src, count 1, seconds 300; reference: url,https://developer.okta.com/docs/reference/api/event-types/; sid:XXXXX; rev:1;)
##Auto Comment: 'The user "XXX_alternateId_XXX" was observed attempting to use an invalid self service recovery token from source <ip>SRCIP</ip>[ XXX_location_XXX ]. Quadrant recommends determining if this is an attempted credential replay or due to a misconfiguration.'
##Signature Playbook: 'This rule is designed to trigger once per five minutes by source IP on a user attempting to use an invalid self service recovery token. This could be a means of attempted credential replay. This could also be due to a misconfiguration. This alert is meant to notify the client of this event so they can investigate the issue further and is informational in nature.'
##Sample Logs:
##okta_system_log-19700101.log.gz:{"version":"0","uuid":"8675309-8675309-8675309-8675309","transaction":{"type":"WEB","id":"8675309"},"target[0]":{"type":"User","id":"unknown","displayName":"unknown","alternateId":"unknown"},"severity":"WARN","securityContext":{"isp":"verizon","isProxy":"false","domain":".","asNumber":"8675309"},"request":{"ipChain[0]":{"version":"V4","ip":"8.8.8.8","geographicalContext":{"state":"STATE","postalCode":"1337","geolocation":{"lon":"XX.XXXXX","lat":"XX.XXXXX"},"country":"COUNTRY","city":"CITY"}}},"published":"2022-06-10T09:56:50.127Z","outcome":{"result":"FAILURE","reason":"Invalid token"},"legacyEventType":"core.user_auth.self_service.invalid_recovery_token","eventType":"user.account.use_token","displayMessage":"Invalid self service recovery token used by user","debugContext":{"debugData":{"url":"/api/v1/authn/recovery/token?","threatSuspected":"false","requestUri":"/api/v1/authn/recovery/token","requestId":"8675309","invalidToken":"8675309"}},"client":{"zone":"null","userAgent":{"rawUserAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36","os":"Windows 10","browser":"CHROME"},"ipAddress":"8.8.8.8","geographicalContext":{"state":"STATE","postalCode":"1337","geolocation":{"lon":"XX.XXXXX","lat":"XX.XXXXX"},"country":"COUNTRY","city":"CITY"},"device":"Computer"},"authenticationContext":{"externalSessionId":"unknown","authenticationStep":"0"},"actor":{"type":"SystemPrincipal","id":"8675309","displayName":"Okta System","alternateId":"system@okta.com"},"SOURCE":"s_okta-system-log","PROGRAM":"okta-system-log_relayer","HOST_FROM":"example.host","HOST":"example.host"}
