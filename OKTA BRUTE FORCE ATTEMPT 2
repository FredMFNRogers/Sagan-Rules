##OKTA BRUTE FORCE ATTEMPT [2]
alert any $EXTERNAL_NET any -> $HOME_NET any (msg:"[OKTA] BRUTE FORCE ATTEMPT [1]"; content: "User login to Okta"; content:"core.user_auth.login_failed"; xbits: set,brute_force,track ip_src, expire 21600; default_proto: tcp; default_dst_port: $SSH_PORT; classtype: brute-force; program: sshd; normalize; parse_src_ip: 1; parse_port; after: track by_src, count 10, seconds 300; threshold: type suppress, track by_src, count 1, seconds 300; reference: XXXXXX; sid: XXXXXX; rev:1;)
##Auto Comment: 'Brute Force Login failures for account name "XXX_alternateId_XXX" from source IP <ip>SRCIP</ip> <hn>SRCHOST</hn> reported by <ip>DSTIP</ip> <hn>DSTHOST</hn>. Quadrant recommends verifying if this is due to a configuration issue or a true brute force attempt.'
##Signature Playbook: 'This rule is designed to trigger on ten or more consecutive failed logins within five minutes per IP. This can be a sign of someone trying to brute force this account's password. This can also be indictive of a configuration issue.'
##Sample Logs:
##okta_system_log-20220607.log.gz:{"version":"0","uuid":"eeaea4ac-e2ea-11ec-967d-555f76de6e99","transaction":{"type":"WEB","id":"8675309"},"severity":"WARN","securityContext":{"isp":"centurylink communications  llc","isProxy":"false","domain":"example.com","asOrg":"ORGANIZATION","asNumber":"1337"},"request":{"ipChain[1]":{"version":"V4","ip":"8.8.8.8","geographicalContext":{"state":"Iowa","postalCode":"1337","geolocation":{"lon":"XX.XXXXX","lat":"XX.XXXXX"},"country":"COUNTRY","city":"CITY"}},"ipChain[0]":{"version":"V4","ip":"8.8.4.4","geographicalContext":{"state":"STATE","postalCode":"1337","geolocation":{"lon":"XX.XXXXX","lat":"XX.XXXXX"},"country":"COUNTRY","city":"CITY"}}},"published":"2022-06-03T03:11:59.629Z","outcome":{"result":"FAILURE","reason":"LOCKED_OUT"},"legacyEventType":"core.user_auth.login_failed","eventType":"user.session.start","displayMessage":"User login to Okta","debugContext":{"debugData":{"url":"/app/office365/sso/wsfed/active?","threatSuspected":"false","targetEventHookIds":"8675309","requestUri":"/app/office365/sso/wsfed/active","requestId":"8675309","logOnlySecurityData":"{\"risk\":{\"reasons\":\"Anomalous Location, Anomalous Device\",\"level\":\"HIGH\"},\"behaviors\":{\"New Geo-Location\":\"UNKNOWN\",\"New Device\":\"UNKNOWN\",\"New IP\":\"8.8.8.8\",\"New State\":\"STATE\",\"New Country\":\"COUNTRY\",\"Velocity\":\"UNKNOWN\",\"New City\":\"CITY\"}}"}},"client":{"zone":"null","userAgent":{"rawUserAgent":"ExchangeServicesClient/15.00.0913.015","os":"Unknown","browser":"UNKNOWN"},"ipAddress":"8.8.4.4","geographicalContext":{"state":"STATE","postalCode":"1337","geolocation":{"lon":"XX.XXXXX","lat":"XX.XXXXX"},"country":"COUNTRY","city":"CITY"},"device":"Unknown"},"authenticationContext":{"externalSessionId":"unknown","authenticationStep":"0"},"actor":{"type":"User","id":"8675309","displayName":"USERNAME","alternateId":"USERNAME@example.host"},"SOURCE":"s_okta-system-log","PROGRAM":"okta-system-log_relayer","HOST_FROM":"example.host","HOST":"example.host"}
